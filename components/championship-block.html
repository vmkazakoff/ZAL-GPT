<div x-show="$store.app.championshipData">
  <!-- Tabs Container - Show only in championship mode -->
  <div class="flex space-x-8" x-show="$store.app.mode === 'championship'">
    <button
      x-on:click="$store.app.activeTab = 'tasks';"
      :class="$store.app.activeTab === 'tasks' ? 'text-red-700' : 'text-slate-400 hover:text-slate-700'"
      class="w-1/2 px-1 py-2 text-center font-medium transition-colors"
    >
      Задания
    </button>
    <button
      x-on:click="$store.app.loadChampionshipDashboardData(); $store.app.activeTab = 'dashboard';"
      :class="$store.app.activeTab === 'dashboard' ? 'text-red-700' : 'text-slate-400 hover:text-slate-700'"
      class="w-1/2 px-1 py-2 text-center font-medium transition-colors"
    >
      Дашборд
    </button>
  </div>

  <!-- Championship Banner - Show only in championship mode -->
  <div class="rounded-t-xl bg-red-700 p-4 text-white" :class="$store.app.mode === 'stack' ? 'mt-8' : ''">
    <div class="flex items-center">
      <i class="fas fa-trophy mr-5 text-4xl"></i>
      <div class="flex-grow">
        <h2 x-text="$store.app.championshipData?.title || ''" class="text-xl font-bold"></h2>
        <p x-text="$store.app.championshipData?.description || ''" class="text-red-100"></p>
      </div>
    </div>
  </div>

  <!-- Tasks Tab Content - Show always, but tabs only in championship mode -->
  <div x-show="$store.app.mode === 'championship' ? $store.app.activeTab === 'tasks' : true">
    <!-- Championship/Stack Tasks List -->
    <div class="rounded-b-xl border border-gray-200 bg-white shadow-lg">
      <div class="flex w-full justify-between overflow-x-auto py-4">
        <template x-for="(task, taskId) in $store.app.tasks">
          <div
            :class="$store.app.currentTaskId === taskId ? 'bg-slate-100 opacity-100' : 'opacity-60'"
            class="championship-task-item group mx-4 flex cursor-pointer flex-col items-center rounded-lg px-1 py-4 transition-all duration-200 hover:opacity-100"
            x-on:click="$store.app.loadTaskData(taskId);"
          >
            <!-- Task Label -->
            <div class="task-label mb-3 max-w-[100px] text-center text-xs font-normal break-words text-black">
              <span x-text="`Задание ${task.taskNumber || ''}`"></span>
            </div>

            <!-- Task Circle with Icon -->
            <div class="relative flex">
              <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full font-bold">
                <i
                  :class="task.status === 'completed' ? 'text-yellow-500' : 'text-gray-400'"
                  class="task-icon fas fa-star absolute z-9 -translate-y-[2px] text-5xl"
                ></i>
                <span
                  class="task-number relative z-9 inline-flex h-full w-full items-center justify-center text-sm text-white"
                  x-text="task.status === 'completed' ? task.bestScore.toFixed(1) : ''"
                ></span>
              </div>
            </div>

            <!-- Task ID/Title -->
            <div class="task-id mt-2 line-clamp-2 max-w-[100px] text-center text-xs font-normal break-words text-black">
              <span x-text="task.title || taskId"></span>
            </div>
          </div>
          <!-- Separator between tasks (excluding last) -->
          <div class="h-1/2 border-b-2 border-gray-300"></div>
        </template>
      </div>

      <!-- Exercise Rating Toggle - Show only in championship mode -->
      <div x-data="{exerciseRatingOpen: false}" x-show="$store.app.mode === 'championship'">
        <div
          class="group mx-4 my-2 flex cursor-pointer items-center justify-between rounded-lg bg-slate-100 px-4 py-2 hover:bg-slate-200"
          @click="exerciseRatingOpen = !exerciseRatingOpen; if (exerciseRatingOpen && $store.app.exerciseRatingByTeams.length === 0) { $store.app.loadExerciseRatingByTeams($store.app.currentTaskId); }"
        >
          <div class="flex items-center">
            <i class="fas fa-chart-line mr-2 text-slate-600"></i>
            <span class="font-medium text-slate-700">Рейтинг по упражнению</span>
          </div>

          <div class="flex gap-2">
            <button
              @click.stop="$store.app.loadExerciseRatingByTeams($store.app.currentTaskId)"
              :disabled="$store.app.loadingExerciseRating"
              class="flex cursor-pointer items-center text-sm text-transparent transition-all duration-300 group-hover:text-slate-600 hover:text-slate-800 disabled:text-slate-600"
            >
              <i class="fas fa-sync-alt mr-1" :class="$store.app.loadingExerciseRating ? 'animate-spin' : ''"></i>
            </button>
            <i
              :class="exerciseRatingOpen ? 'fa-chevron-up' : 'fa-chevron-down'"
              class="fas text-slate-600 transition-transform duration-200"
            ></i>
          </div>
        </div>

        <!-- Refresh button -->

        <!-- Exercise Rating Table -->
        <div x-show="exerciseRatingOpen" class="mx-4 mb-4 overflow-x-auto">
          <div class="text-center text-gray-500">
            <span class="py-4" x-show="$store.app.loadingExerciseRating">Загрузка рейтинга...</span>
            <span
              class="py-4"
              x-show="!$store.app.loadingExerciseRating && $store.app.exerciseRatingByTeams.length === 0"
            >
              Нет данных для отображения
            </span>
          </div>

          <!-- Rating list -->
          <div
            x-show="!$store.app.loadingExerciseRating && $store.app.exerciseRatingByTeams.length > 0"
            class="space-y-1"
          >
            <template x-for="(item, index) in $store.app.exerciseRatingByTeams" :key="`rating-${index}`">
              <div
                class="flex items-center justify-between rounded-lg px-4 py-1 transition-colors duration-200 hover:bg-slate-100"
              >
                <div class="flex items-center">
                  <div class="mr-6 w-8 text-slate-700" x-text="item.rank"></div>
                  <div class="text-black" x-text="item.name"></div>
                </div>
                <div class="text-right">
                  <span class="font-bold text-black" x-text="item.score.toFixed(1)"></span>
                  <i class="fas fa-star ml-1 text-yellow-500"></i>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard Tab Content - Show only in championship mode -->
  <div x-show="$store.app.mode === 'championship' && $store.app.activeTab === 'dashboard'">
    <!-- Dashboard Championship Tasks List -->
    <div class="mb-8 rounded-b-xl border border-gray-200 bg-white shadow-lg">
      <div class="flex w-full justify-between overflow-x-auto py-4">
        <template x-for="(task, taskId) in $store.app.tasks">
          <div
            x-data="{ task: task, taskId: taskId }"
            class="dashboard-championship-task-item mx-4 flex flex-col items-center px-1 py-4"
          >
            <!-- Task Label -->
            <div class="task-label mb-3 max-w-[100px] text-center text-xs font-normal opacity-60">
              <span x-text="`Задание ${task.taskNumber}`"></span>
            </div>

            <!-- Team Count Display -->
            <div class="w-full rounded-lg bg-slate-100 p-2 text-center">
              <div class="text-sm">Выполнило</div>
              <div class="text-2xl font-bold" :class="$store.app.loadingDashboardData ? 'animate-pulse' : ''">
                <span x-text="$store.app.dashboardStatsByTeams[taskId]?.completedTeamsCount || 0"></span>
              </div>
              <div class="text-xs">
                <span
                  x-text="
                    const count = $store.app.dashboardStatsByTeams[taskId]?.completedTeamsCount || 0;
                    if (count === 1) return 'команда';
                    if (count >= 2 && count <= 4) return 'команды';
                    return 'команд';"
                ></span>
                <span x-show="$store.app.loadingDashboardData">&nbsp;</span>
              </div>
            </div>

            <!-- Task ID/Title -->
            <div class="task-id mt-2 line-clamp-2 max-w-[100px] text-center text-xs break-words opacity-60">
              <span x-text="task.title || taskId"></span>
            </div>
          </div>
        </template>

        <!-- Separator between tasks (excluding last) -->
        <template
          x-data="{
          taskKeys: Object.keys($store.app.tasks || {}),
          isLastTask(key) {
            return this.taskKeys[this.taskKeys.length - 1] === key;
          }
        }"
        >
          <template x-for="(task, taskId) in $store.app.tasks || {}">
            <div
              x-show="!isLastTask(taskId)"
              class="flex-1"
              :key="`dash-sep-${taskId}-${$store.app.tasks[taskId].taskNumber}`"
            >
              <div class="h-1/2 border-b-2 border-gray-300"></div>
            </div>
          </template>
        </template>
      </div>
    </div>

    <!-- Dashboard Championship Rating Table -->
    <div class="mb-8 rounded-xl border border-gray-200 bg-white p-6 shadow-lg">
      <div class="mb-4 flex items-center justify-between">
        <h3 class="text-xl font-bold text-gray-800">Рейтинг лидеров</h3>
        <button
          @click="$store.app.loadChampionshipDashboardData()"
          :disabled="$store.app.loadingDashboardData"
          class="text-gray-600 hover:text-gray-800 disabled:opacity-50"
        >
          <i class="fas fa-sync-alt" :class="$store.app.loadingDashboardData ? 'animate-spin' : ''"></i>
        </button>
      </div>

      <div
        x-show="$store.app.championshipRatingByTeams.length === 0"
        class="text-center text-gray-500"
        :class="$store.app.loadingDashboardData ? 'animate-pulse' : ''"
      >
        <div class="py-8" x-show="$store.app.loadingDashboardData">Загрузка рейтинга...</div>
        <div class="py-8" x-show="!$store.app.loadingDashboardData">Нет данных для отображения</div>
      </div>

      <!-- Rating list -->
      <div
        x-show="$store.app.championshipRatingByTeams.length > 0"
        class="overflow-x-auto"
        :class="$store.app.loadingDashboardData ? 'animate-pulse' : ''"
      >
        <div class="space-y-1">
          <template x-for="(item, index) in $store.app.championshipRatingByTeams" :key="`rating-${index}`">
            <div
              class="flex items-center justify-between rounded-lg p-2 transition-colors duration-200 hover:bg-slate-100"
            >
              <div class="flex items-center">
                <div class="mr-6 w-8 text-2xl font-bold text-slate-700" x-text="item.rank"></div>
                <div>
                  <div class="text-lg font-bold text-black" x-text="item.name"></div>
                  <div class="text-sm text-slate-400">
                    Выполнено заданий: <span x-text="item.completedTasks"></span>
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div
                  class="dashboard-rating-total-score text-xl font-bold text-black"
                  x-text="item.totalScore.toFixed(1)"
                ></div>
                <div class="text-sm text-slate-400">баллов</div>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>
</div>
